# Лабораторная работа №5: Nginx, TLS и балансировка нагрузки

## Цели
- Настроить Nginx для обратного проксирования запросов к нескольким экземплярам сервера.  
- Реализовать TLS для шифрования соединений.  
- Организовать раздачу статических файлов через Nginx.  
- Настроить round-robin балансировку нагрузки между серверными инстансами.  
- Проверить идентификацию обработавшего запрос инстанса.

---

## Задачи

1. **Три Docker-инстанса сервера**  
   - Поднять три экземпляра вашего сервера в Docker.  
   - Каждый инстанс должен показывать свой уникальный идентификатор (например, в HTTP-заголовке или теле ответа).

2. **Конфигурация Nginx**  
   - Создать upstream-блок с тремя серверами и round-robin стратегией.  
   - Настроить `proxy_pass` для проксирования запросов на upstream.  
   - Запретить прямой доступ к серверам (открыть только порты Nginx).

3. **Раздача статических файлов**  
   - Настроить `location /static/` в Nginx, чтобы файлы отдавались из локальной папки без проксирования на бэкенд.

4. **TLS с самоподписанным сертификатом**  
   - Сгенерировать сертификат и ключ через OpenSSL.  
   - Подключить их в конфиге Nginx:  
     ```nginx
     server {
       listen 443 ssl;
       server_name localhost;
       ssl_certificate     /etc/nginx/certs/server.crt;
       ssl_certificate_key /etc/nginx/certs/server.key;
       …
     }
     ```

5. **Тестирование и проверка**  
   - Сделать несколько запросов `curl -k https://localhost/` и убедиться, что ответы приходят от разных backend-инстансов.  
   - Проверить выдачу статических ресурсов:  
     ```bash
     curl -k https://localhost/static/style.css
     ```
   - Попытаться обратиться напрямую к контейнерам приложений (`curl http://app1:8080`) — доступ должен быть закрыт.

6. **Документация и скриншоты**  
   - Собрать примеры команд `curl` и их вывод.  
   - Сохранить скриншоты распределения нагрузки (консольные логи или браузер).  
   - Описать шаги настройки и результаты в Markdown-документе.

---

## Пример структуры проекта

```text
project-root/
├── server/
│   ├── Dockerfile           # одинаковый для app1, app2, app3
│   └── … (исходники сервера)
├── nginx/
│   ├── default.conf         # конфиг Nginx
│   └── certs/
│       ├── server.crt
│       └── server.key
├── .env
├── docker-compose.yml
├── start.sh
└── docs/
    ├── screenshots/         # скриншоты тестов
    └── curl_examples.sh     # примеры запросов
